# Multifractal analysis of multispecies spatial distributions - Model simulations 

I generate parameter files for the simulation of neutral/hierarchical model using logseries as the metacommunity distribution


```{r setup, eval=T }
load(".RData")
#simul  <- F # variable to perform or not the simulations

oldcd <-getwd()
source("R/Neutral_fun.r")

# Set the location of the binary 
#
neuBin <- "~/Dropbox/cpp/CaNew/Neutral/ipsNeutralExp"
neuBin64<- "~/Dropbox/cpp/CaNew/Neutral/ipsNeutralE64"


require(pander)
panderOptions('table.split.table',Inf)
options("scipen"=100, "digits"=4)
```

## Simulations with different parameters using pomac and at Time=100

Now I will simulate the model to Time=500 with a full set of parameters 
Replacement = 0,0.001,0.01,0.1,1 and ten repetitions 

```{r simul256_LogSerParms, eval=F,echo=F,message=F,warning=F}
setwd("Simul")
#simul <- data.frame()
simul <- rbind(simul,simulNeutral_1Time(8,256,500))
simul <- rbind(simul,simulNeutral_1Time(64,256,500))
simul <- rbind(simul,simulNeutral_1Time(256,256,500))

setwd(oldcd)
save.image()

```

```{r simul512_LogSerParms, eval=F,echo=F,message=F,warning=F}
setwd("Simul")

simul <- rbind(simul,simulNeutral_1Time(8,512,500))
simul <- rbind(simul,simulNeutral_1Time(64,512,500))
simul <- rbind(simul,simulNeutral_1Time(256,512,500))

# rename s/'64'/'64_512'/ *neuFish64*.txt 

setwd(oldcd)
save.image()

```

Calculate power of DqSAD DqSRS

```{r power_LogSerParms, eval=T,echo=F,message=F,warning=F}
setwd("Simul")

# Testing
#simul <- data.frame()
#sim1 <- rbind(simul,simulNeutral_1Time(65,256,100,"L",3))
#sim1 <- data.frame(nsp=65,side=256,time=100,meta="L",spMeta=87,rep=3)
#cc <- powerNeutral_1Time(sim1)

require(doParallel)
cl <- makeCluster(2)
registerDoParallel(cl)
require(foreach)

pow_AD <- data.frame()
comp_AD<- data.frame()
foreach(i=1:nrow(simul)) %dopar%
{
  cc <- powerNeutral_1Time(simul[i,])
}
for(i in 1:nrow(simul)) {
pow_AD <- rbind(pow_AD, cc[[i]]$pow_AD)
comp_AD<- rbind(comp_AD,cc[[i]]$comp_AD)
}
rm(cc)
setwd(oldcd)
save.image()
```

Calculate power by number of species


```{r power_LogSer1, eval=F,echo=T,message=T,warning=T}
setwd("Simul")


hh <-function(x) {
  t <- nrow(x)
  s <- nrow(x[x$p.value<0.05,])
  data.frame(power=s/t,n=t)
}
require(plyr)
c1 <- ddply(comp_AD,.(Type,NumSp),hh)
c1 <- with(comp_AD,comp_AD[MrtR1==MrtR2 & DspD1==DspD2 & ClnR1==ClnR2,])
c1 <- with(comp_AD,comp_AD[MrtR1==MrtR2 & DspD1==DspD2 & ClnR1==ClnR2 & RplR1==RplR2,])
c2 <- ddply(c1,.(Type,NumSp),hh)
unique(c1$MrtR1)
unique(c1$DspD1)
unique(c1$ClnR1)

```

